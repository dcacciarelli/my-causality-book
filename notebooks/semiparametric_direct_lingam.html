
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3. Linear models &#8212; An introduction to causal Inference for electricity markets</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/semiparametric_direct_lingam';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Nonlinear models" href="semiparametric_resit.html" />
    <link rel="prev" title="2. Basic causal structures" href="basic_dag_structures.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_round.png" class="logo__image only-light" alt="An introduction to causal Inference for electricity markets - Home"/>
    <script>document.write(`<img src="../_static/logo_round.png" class="logo__image only-dark" alt="An introduction to causal Inference for electricity markets - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    An introduction to causal inference for electricity markets
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Key concepts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="correlation_vs_causation.html">1. Why studying causal inference?</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_dag_structures.html">2. Basic causal structures</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Semi-parametric approaches</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">3. Linear models</a></li>
<li class="toctree-l1"><a class="reference internal" href="semiparametric_resit.html">4. Nonlinear models</a></li>
<li class="toctree-l1"><a class="reference internal" href="semiparametric_varlingam.html">5. Time series models</a></li>
<li class="toctree-l1"><a class="reference internal" href="structural_breaks_example.html">6. Time series with structural breaks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/semiparametric_direct_lingam.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/semiparametric_direct_lingam.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Linear models</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-lingam-model">3.1. The LiNGAM model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#strucural-equations">3.1.1. Strucural equations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-notation">3.1.2. Matrix notation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#causal-ordering">3.1.3. Causal ordering</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-methods">3.2. Estimation methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-with-gaussian-errors">3.2.1. Example with Gaussian errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-with-non-gaussian-errors">3.2.2. Example with non-Gaussian errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#full-lingam-estimation-example">3.2.3. Full LiNGAM estimation example</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="linear-models">
<h1><span class="section-number">3. </span>Linear models<a class="headerlink" href="#linear-models" title="Link to this heading">#</a></h1>
<p>If we are willing to make assumptions about the <strong>functional form</strong> of the structural causal model or the <strong>distribution of the errors</strong>, we can go beyond the Markov equivalence class and identify the complete causal structure of the data-generating process. In this first chapter of semi-parametric models, we introduce the <strong>linear non-Gaussian acyclic model (LiNGAM)</strong> <span id="id1">[<a class="reference internal" href="../bibliography.html#id3" title="Shohei Shimizu, Patrik O Hoyer, Aapo Hyvärinen, Antti Kerminen, and Michael Jordan. A linear non-gaussian acyclic model for causal discovery. Journal of Machine Learning Research, 2006.">SHHyvarinen+06</a>]</span>.</p>
<section id="the-lingam-model">
<h2><span class="section-number">3.1. </span>The LiNGAM model<a class="headerlink" href="#the-lingam-model" title="Link to this heading">#</a></h2>
<p>The LiNGAM model for <span class="math notranslate nohighlight">\(p\)</span> observed variables <span class="math notranslate nohighlight">\(x_1, x_2, \ldots, x_p\)</span> is given by</p>
<div class="amsmath math notranslate nohighlight" id="equation-a8e76296-aaab-4e42-b825-714750342b0c">
<span class="eqno">(3.1)<a class="headerlink" href="#equation-a8e76296-aaab-4e42-b825-714750342b0c" title="Permalink to this equation">#</a></span>\[\begin{equation}
    x_i = \sum_{j \in \operatorname{pa}(x_i)}b_{ij}x_j + e_i \quad (i=1, \ldots, p)
\end{equation}\]</div>
<p>where each observed variable <span class="math notranslate nohighlight">\(x_i\)</span> is a linear sum of their parent variables <span class="math notranslate nohighlight">\(\operatorname{pa}(x_i)\)</span> plus some noise <span class="math notranslate nohighlight">\(e_i\)</span>. If the coefficient <span class="math notranslate nohighlight">\(b_{ij}\)</span> is zero, then there is no direct causal effect from <span class="math notranslate nohighlight">\(x_j\)</span> to <span class="math notranslate nohighlight">\(x_i\)</span>. The error variables <span class="math notranslate nohighlight">\(e_i\)</span> are <strong>independent</strong> and follow continuous <strong>non-Gaussian</strong> distributions. The independence means there are <strong>no unobserved or hidden common causes</strong>.</p>
<p>In matrix notation, the model is given by</p>
<div class="amsmath math notranslate nohighlight" id="equation-9a7ff138-b4c0-4403-a480-fd442e713b6f">
<span class="eqno">(3.2)<a class="headerlink" href="#equation-9a7ff138-b4c0-4403-a480-fd442e713b6f" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \mathbf{x} = \mathbf{B}\mathbf{x} + \mathbf{e}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{e}\)</span> are <span class="math notranslate nohighlight">\(p\)</span>-dimensional vectors, and <span class="math notranslate nohighlight">\(\mathbf{B}\)</span> is a <span class="math notranslate nohighlight">\(p\times p\)</span> matrix that contains the <span class="math notranslate nohighlight">\(b_{ij}\)</span> coefficients, with <span class="math notranslate nohighlight">\(i, j=1, \ldots, p\)</span>.</p>
<p>Let us consider a simple <strong>example</strong> with three variables. To ease the introduction of the LiNGAM model, we will use the variables from the chain example of the previous chapters, where:</p>
<ul class="simple">
<li><p><strong>Wind forecast errors</strong> are directly influences by sudden changes in the weather.</p></li>
<li><p><strong>Balancing costs</strong> are influenced by wind forecast errors. For example, if the system is short because it was expecting a larger production from wind farms, it might incur balancing costs to procure electricity from alternative sources.</p></li>
<li><p><strong>Weather fluctuarions</strong> are influenced by external factors and serve as an exogenous variable in this model.</p></li>
</ul>
<section id="strucural-equations">
<h3><span class="section-number">3.1.1. </span>Strucural equations<a class="headerlink" href="#strucural-equations" title="Link to this heading">#</a></h3>
<p>If we know the coefficients of those causal relations, the <strong>SCM</strong> can be written as</p>
<div class="amsmath math notranslate nohighlight" id="equation-f0b0dced-0b61-43ac-a4fc-d291bd509820">
<span class="eqno">(3.3)<a class="headerlink" href="#equation-f0b0dced-0b61-43ac-a4fc-d291bd509820" title="Permalink to this equation">#</a></span>\[\begin{align}
\text{wind forecast errors} &amp;= 1.5 \times \text{weather flucturations} + e_f \\
\text{balancing costs} &amp;= 1.2 \times \text{wind forecast errors} + e_b \\
\text{weather fluctuations} &amp;= e_w \\
\end{align}\]</div>
</section>
<section id="matrix-notation">
<h3><span class="section-number">3.1.2. </span>Matrix notation<a class="headerlink" href="#matrix-notation" title="Link to this heading">#</a></h3>
<p>Then, in matrix notation, this model is given by</p>
<div class="amsmath math notranslate nohighlight" id="equation-b6f5ae93-82fc-4442-b68d-0c0d4bf87aba">
<span class="eqno">(3.4)<a class="headerlink" href="#equation-b6f5ae93-82fc-4442-b68d-0c0d4bf87aba" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \left[\begin{array}{c} 
    \text{wind forecast errors} \\
    \text{balancing costs} \\
    \text{weather fluctuations}
    \end{array}\right]
    =
    \left[\begin{array}{ccc}
    0 &amp; 0 &amp; 1.5 \\
    1.2 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; 0
    \end{array}\right]
    \left[\begin{array}{c} 
    \text{wind forecast errors} \\
    \text{balancing costs} \\
    \text{weather fluctuations}
    \end{array}\right]
    +
    \left[\begin{array}{c}
    e_f \\
    e_b \\
    e_w
    \end{array}\right]
\end{equation}\]</div>
</section>
<section id="causal-ordering">
<h3><span class="section-number">3.1.3. </span>Causal ordering<a class="headerlink" href="#causal-ordering" title="Link to this heading">#</a></h3>
<p>Typically, we <strong>order</strong> the the structural equations according to the <strong>true causal order</strong>, so that the matrix <span class="math notranslate nohighlight">\(\mathbf{B}\)</span> is permuted to be a <strong>lower triangular matrix</strong> (this property is used later on to identify the true structure), with all the diagonal elements equal to zero (strictly lower triangular). This simply means that we rewrite the structural equations as</p>
<div class="amsmath math notranslate nohighlight" id="equation-7fd34657-5fc5-4f4f-89a4-4bae89cc9993">
<span class="eqno">(3.5)<a class="headerlink" href="#equation-7fd34657-5fc5-4f4f-89a4-4bae89cc9993" title="Permalink to this equation">#</a></span>\[\begin{align}
\text{weather fluctuations} &amp;= e_w \\
\text{wind forecast errors} &amp;= 1.5 \times \text{weather flucturations} + e_f \\
\text{balancing costs} &amp;= 1.2 \times \text{wind forecast errors} + e_b \\
\end{align}\]</div>
<p>that, in matrix notation, becomes</p>
<div class="amsmath math notranslate nohighlight" id="equation-9c70512e-42e8-407a-96e7-38ee7f826271">
<span class="eqno">(3.6)<a class="headerlink" href="#equation-9c70512e-42e8-407a-96e7-38ee7f826271" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \left[\begin{array}{c} 
    \text{weather fluctuations} \\
    \text{wind forecast errors} \\
    \text{balancing costs}
    \end{array}\right]
    =
    \left[\begin{array}{ccc}
    0 &amp; 0 &amp; 0 \\
    1.5 &amp; 0 &amp; 0 \\
    0 &amp; 1.2 &amp; 0
    \end{array}\right]
    \left[\begin{array}{c} 
    \text{weather fluctuations} \\
    \text{wind forecast errors} \\
    \text{balancing costs}
    \end{array}\right]
    +
    \left[\begin{array}{c}
    e_w \\
    e_f \\
    e_b
    \end{array}\right]
\end{equation}\]</div>
<p>Now, we can rewrite the LiNGAM model as</p>
<div class="amsmath math notranslate nohighlight" id="equation-a61cc0d7-0191-4366-958b-8e4ff66f694b">
<span class="eqno">(3.7)<a class="headerlink" href="#equation-a61cc0d7-0191-4366-958b-8e4ff66f694b" title="Permalink to this equation">#</a></span>\[\begin{equation}
    x_i = \sum_{j:k(j)&lt;k(i)}b_{ij}x_j + e_i \quad (i=1, \ldots, p)
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(k(\cdot)\)</span> represents the causal ordering, meaning that each variable <span class="math notranslate nohighlight">\(x_i\)</span> is a linear sum of the <span class="math notranslate nohighlight">\(x_j\)</span> variables observed earlier in the causal graph (<span class="math notranslate nohighlight">\(k(j)&lt;k(i)\)</span>), plus its own error variable <span class="math notranslate nohighlight">\(e_i\)</span>. We can now plot the <strong>causal graph</strong>, using the LiNGAM library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">lingam.utils</span> <span class="kn">import</span> <span class="n">make_dot</span>

<span class="c1"># Matrix of coefficients (weights)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
              <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
              <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]])</span>

<span class="c1"># Plotting causal graph</span>
<span class="n">make_dot</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;weather </span><span class="se">\n</span><span class="s2">fluctuations&quot;</span><span class="p">,</span> <span class="s2">&quot;wind forecast </span><span class="se">\n</span><span class="s2">errors&quot;</span><span class="p">,</span> <span class="s2">&quot;balancing </span><span class="se">\n</span><span class="s2">costs&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/516eab5ea2ac5b1328d958b2e37254521bb18ea3e8900f63d69d03fd26d996b4.svg" src="../_images/516eab5ea2ac5b1328d958b2e37254521bb18ea3e8900f63d69d03fd26d996b4.svg" /></div>
</div>
</section>
</section>
<section id="estimation-methods">
<h2><span class="section-number">3.2. </span>Estimation methods<a class="headerlink" href="#estimation-methods" title="Link to this heading">#</a></h2>
<p>Now that we explained the basic formulation, we explain how to <strong>estimate the model from the data</strong>. There are two main approaches to estimate a LiNGAM model: a direct estimation method (<strong>DirectLiNGAM</strong>) through a series of regressions and independence tests, and a method based on independent component analysis (ICA) (<strong>ICA-based LinGAM</strong>). In the case of linear models, the key assumption is that the <strong>errors are non-Gaussians</strong>. This is the most important assumption as it allows us to identify the causal structure, both using DirectLiNGAM and ICA-based LiNGAM.</p>
<p>Now, we will explain the intuition behing DirectLiNGAM, an iterative procedure that employs a series of regressions and independence tests to directly identify the causal order among the observed variables. It leverages the non-Gaussianity of the data and the assumption of linear causality to systematically test for independence between variables and their residuals from regressions.</p>
<p>The key intuition is that, with non-Gaussian errors, the <strong>residuals in the anti-causal direction</strong> will not be independent of the predictor. We will see how this works with a practical example.</p>
<section id="example-with-gaussian-errors">
<h3><span class="section-number">3.2.1. </span>Example with Gaussian errors<a class="headerlink" href="#example-with-gaussian-errors" title="Link to this heading">#</a></h3>
<p>Let us consider a simple example, like the one we saw above, but for simplicity we only keep two variables:</p>
<div class="amsmath math notranslate nohighlight" id="equation-2ad13c96-5fee-4dc4-bb03-6ddec59d3c56">
<span class="eqno">(3.8)<a class="headerlink" href="#equation-2ad13c96-5fee-4dc4-bb03-6ddec59d3c56" title="Permalink to this equation">#</a></span>\[\begin{align}
\text{weather fluctuations} &amp;= e_w \\
\text{wind forecast errors} &amp;= 1.5 \times \text{weather flucturations} + e_f \\
\end{align}\]</div>
<p>We now assume Gaussian errors, so we have that <span class="math notranslate nohighlight">\(e_w, e_f  \sim \mathcal{N}(0, 1)\)</span>.</p>
<p>We will show that, in this case, by analysing the residuals we cannot understand the true causal direction, because we can both predict the wind from the prices and the prices from the wind.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Synthetic data generation based on the given equations</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">weather_fluctuations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># Predictor variable</span>
<span class="n">forecast_errors</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">weather_fluctuations</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># Response variable with non-Gaussian noise (uniform)</span>

<span class="c1"># Prepare the data for regression</span>
<span class="n">weather_fluctuations_with_const</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">weather_fluctuations</span><span class="p">)</span>  <span class="c1"># Add a constant term for the intercept</span>
<span class="n">forecast_errors_with_const</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">forecast_errors</span><span class="p">)</span>  <span class="c1"># Add a constant term for the intercept</span>

<span class="c1"># Linear regression in the true causal direction (wind -&gt; price)</span>
<span class="n">true_model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">endog</span><span class="o">=</span><span class="n">forecast_errors</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">weather_fluctuations_with_const</span><span class="p">)</span>
<span class="n">true_model_results</span> <span class="o">=</span> <span class="n">true_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">forecast_errors_pred</span> <span class="o">=</span> <span class="n">true_model_results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">weather_fluctuations_with_const</span><span class="p">)</span>
<span class="n">forecast_errors_residuals</span> <span class="o">=</span> <span class="n">forecast_errors</span> <span class="o">-</span> <span class="n">forecast_errors_pred</span>

<span class="c1"># Linear regression in the anti-causal direction (price -&gt; wind)</span>
<span class="n">anti_model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">endog</span><span class="o">=</span><span class="n">weather_fluctuations</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">forecast_errors_with_const</span><span class="p">)</span>
<span class="n">anti_model_results</span> <span class="o">=</span> <span class="n">anti_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">weather_fluctuations_pred</span> <span class="o">=</span> <span class="n">anti_model_results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">forecast_errors_with_const</span><span class="p">)</span>
<span class="n">weather_fluctuations_residuals</span> <span class="o">=</span> <span class="n">weather_fluctuations</span> <span class="o">-</span> <span class="n">weather_fluctuations_pred</span>

<span class="c1"># Setting up the plots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># All the data</span>
<span class="n">hb1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hexbin</span><span class="p">(</span><span class="n">weather_fluctuations</span><span class="p">,</span> <span class="n">forecast_errors_residuals</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residuals in the true causal direction</span><span class="se">\n</span><span class="s1">(weather fluctuations -&gt; forecast errors)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Weather&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>

<span class="c1"># After conditioning</span>
<span class="n">hb2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hexbin</span><span class="p">(</span><span class="n">forecast_errors</span><span class="p">,</span> <span class="n">weather_fluctuations_residuals</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residuals in the anti-causal direction</span><span class="se">\n</span><span class="s1">(forecast errors -&gt; weather fluctuations)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Forecast errors&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Residuals&#39;)
</pre></div>
</div>
<img alt="../_images/39703d6f76259321a8f061c98aeb3c2d2d6035e391091d171d8f01f5a7f174e1.png" src="../_images/39703d6f76259321a8f061c98aeb3c2d2d6035e391091d171d8f01f5a7f174e1.png" />
</div>
</div>
<p>Where we can see how the residuals are independent of the input variable in both the true and anti-causal directions.</p>
</section>
<section id="example-with-non-gaussian-errors">
<h3><span class="section-number">3.2.2. </span>Example with non-Gaussian errors<a class="headerlink" href="#example-with-non-gaussian-errors" title="Link to this heading">#</a></h3>
<p>Now, by simply assuming the errors are uniformly distributed, we can wee how it will be possible to detect the true causal direction by testing the independence of the residuals from the input variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Synthetic data generation based on the given equations</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">weather_fluctuations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># Predictor variable</span>
<span class="n">forecast_errors</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">weather_fluctuations</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># Response variable with non-Gaussian noise (uniform)</span>

<span class="c1"># Prepare the data for regression</span>
<span class="n">weather_fluctuations_with_const</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">weather_fluctuations</span><span class="p">)</span>  <span class="c1"># Add a constant term for the intercept</span>
<span class="n">forecast_errors_with_const</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">forecast_errors</span><span class="p">)</span>  <span class="c1"># Add a constant term for the intercept</span>

<span class="c1"># Linear regression in the true causal direction (wind -&gt; price)</span>
<span class="n">true_model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">endog</span><span class="o">=</span><span class="n">forecast_errors</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">weather_fluctuations_with_const</span><span class="p">)</span>
<span class="n">true_model_results</span> <span class="o">=</span> <span class="n">true_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">forecast_errors_pred</span> <span class="o">=</span> <span class="n">true_model_results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">weather_fluctuations_with_const</span><span class="p">)</span>
<span class="n">forecast_errors_residuals</span> <span class="o">=</span> <span class="n">forecast_errors</span> <span class="o">-</span> <span class="n">forecast_errors_pred</span>

<span class="c1"># Linear regression in the anti-causal direction (price -&gt; wind)</span>
<span class="n">anti_model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">endog</span><span class="o">=</span><span class="n">weather_fluctuations</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">forecast_errors_with_const</span><span class="p">)</span>
<span class="n">anti_model_results</span> <span class="o">=</span> <span class="n">anti_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">weather_fluctuations_pred</span> <span class="o">=</span> <span class="n">anti_model_results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">forecast_errors_with_const</span><span class="p">)</span>
<span class="n">weather_fluctuations_residuals</span> <span class="o">=</span> <span class="n">weather_fluctuations</span> <span class="o">-</span> <span class="n">weather_fluctuations_pred</span>

<span class="c1"># Setting up the plots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># All the data</span>
<span class="n">hb1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hexbin</span><span class="p">(</span><span class="n">weather_fluctuations</span><span class="p">,</span> <span class="n">forecast_errors_residuals</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residuals in the true causal direction</span><span class="se">\n</span><span class="s1">(weather fluctuations -&gt; forecast errors)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Weather&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>

<span class="c1"># After conditioning</span>
<span class="n">hb2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hexbin</span><span class="p">(</span><span class="n">forecast_errors</span><span class="p">,</span> <span class="n">weather_fluctuations_residuals</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residuals in the anti-causal direction</span><span class="se">\n</span><span class="s1">(forecast errors -&gt; weather fluctuations)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Forecast errors&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Residuals&#39;)
</pre></div>
</div>
<img alt="../_images/dc656ac07b9a9041a27bfdad64a9c6110a1ce7a2856b03e58d06e473f63840f1.png" src="../_images/dc656ac07b9a9041a27bfdad64a9c6110a1ce7a2856b03e58d06e473f63840f1.png" />
</div>
</div>
</section>
<section id="full-lingam-estimation-example">
<h3><span class="section-number">3.2.3. </span>Full LiNGAM estimation example<a class="headerlink" href="#full-lingam-estimation-example" title="Link to this heading">#</a></h3>
<p>Now, we try a full estimation example, where we have a slightly more complex causal structure, that we will need to retrieve from observational data. We now add to the model:</p>
<ul class="simple">
<li><p><strong>Outages</strong>: an exogenous variable affecting the balancing costs.</p></li>
<li><p><strong>heating demand</strong>: a variable affected by changes in the weather, which affects the balancing costs.</p></li>
</ul>
<p>Assume the following <strong>structural equations</strong>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b460bb56-2982-4daa-975d-cd5fcf373127">
<span class="eqno">(3.9)<a class="headerlink" href="#equation-b460bb56-2982-4daa-975d-cd5fcf373127" title="Permalink to this equation">#</a></span>\[\begin{align}
\text{weather fluctuations} &amp;= e_w \\
\text{outages} &amp;= e_o \\
\text{heating demand} &amp;= 0.3 \times \text{weather flucturations} + e_h \\
\text{wind forecast errors} &amp;= 1.5 \times \text{weather flucturations} + e_f \\
\text{balancing costs} &amp;= 1.5 \times \text{outages} + 0.7 \times \text{heating demand} + 1.2 \times \text{wind forecast errors} + e_b \\
\end{align}\]</div>
<p>where the errors are now assumed to be <strong>uniformly distributed</strong>.</p>
<p>Then, the true <strong>causal graph</strong> is given by</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matrix of coefficients (weights)</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>   <span class="c1"># Weather fluctuations</span>
    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>   <span class="c1"># Outages</span>
    <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>   <span class="c1"># Heating demand</span>
    <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>   <span class="c1"># Wind forecast errors</span>
    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>    <span class="c1"># Balancing costs</span>
<span class="p">])</span>

<span class="c1"># Plotting causal graph</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;weather </span><span class="se">\n</span><span class="s2">fluctuations&quot;</span><span class="p">,</span> <span class="s2">&quot;outages&quot;</span><span class="p">,</span> <span class="s2">&quot;heating </span><span class="se">\n</span><span class="s2">demand&quot;</span><span class="p">,</span> <span class="s2">&quot;wind forecast </span><span class="se">\n</span><span class="s2">errors&quot;</span><span class="p">,</span> <span class="s2">&quot;balancing </span><span class="se">\n</span><span class="s2">costs&quot;</span><span class="p">]</span>
<span class="n">make_dot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09dce491da59bfb8e5ac3eb7f78d7b6bead63bd28d1e8f2ddf843c5810dfacb8.svg" src="../_images/09dce491da59bfb8e5ac3eb7f78d7b6bead63bd28d1e8f2ddf843c5810dfacb8.svg" /></div>
</div>
<p>Let us now generate some data from this causal graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Set the random seed for reproducibility</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Number of samples</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># Generating synthetic data based on the specified equations with uniform errors</span>
<span class="n">weather_fluctuations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span> 
<span class="n">outages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">forecast_errors</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">weather_fluctuations</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">heating</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">weather_fluctuations</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">balancing_costs</span> <span class="o">=</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">heating</span> <span class="o">+</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">forecast_errors</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">outages</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># Creating a DataFrame to hold the generated data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;weather fluctuations&#39;</span><span class="p">:</span> <span class="n">weather_fluctuations</span><span class="p">,</span> <span class="s1">&#39;outages&#39;</span><span class="p">:</span> <span class="n">outages</span><span class="p">,</span> <span class="s1">&#39;wind forecast errors&#39;</span><span class="p">:</span> <span class="n">forecast_errors</span><span class="p">,</span>
                     <span class="s1">&#39;heating demand&#39;</span><span class="p">:</span> <span class="n">heating</span><span class="p">,</span> <span class="s1">&#39;balancing costs&#39;</span><span class="p">:</span> <span class="n">balancing_costs</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we fit the <strong>DirectLiNGAM</strong> model and plot the estimated causal structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lingam</span>

<span class="n">direct_model</span> <span class="o">=</span> <span class="n">lingam</span><span class="o">.</span><span class="n">DirectLiNGAM</span><span class="p">()</span>
<span class="n">direct_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">make_dot</span><span class="p">(</span><span class="n">direct_model</span><span class="o">.</span><span class="n">adjacency_matrix_</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2841a14c06717bb8c9daf3f21720453269cbc83feb5df8cceeb55e7ff2c2b9d4.svg" src="../_images/2841a14c06717bb8c9daf3f21720453269cbc83feb5df8cceeb55e7ff2c2b9d4.svg" /></div>
</div>
<p>We can see how we successfully recovered the true casual structure, even though the model did not find the exact coefficients for the wind forecast errors and heating demand.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="basic_dag_structures.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">2. </span>Basic causal structures</p>
      </div>
    </a>
    <a class="right-next"
       href="semiparametric_resit.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">4. </span>Nonlinear models</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-lingam-model">3.1. The LiNGAM model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#strucural-equations">3.1.1. Strucural equations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-notation">3.1.2. Matrix notation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#causal-ordering">3.1.3. Causal ordering</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-methods">3.2. Estimation methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-with-gaussian-errors">3.2.1. Example with Gaussian errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-with-non-gaussian-errors">3.2.2. Example with non-Gaussian errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#full-lingam-estimation-example">3.2.3. Full LiNGAM estimation example</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Davide Cacciarelli
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>